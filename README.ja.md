# Web 2サービスはTusimaを介してWeb 3に接続されている

[English Version](README.md)


  **v1.0.0**

## Default



#### POST registerweb3account

```
POST  /user/registerweb3account
```

> Web3サーバーに登録し、ユーザーのためにバウンドされたWeb3アドレスを生成します。

**リクエストボディパラメータ**

```json
{
  "euserId": 13,
  "euserName": "smithl",
  "email": "r.ngerd@gmail.com",
  "appName": "damai",
  "phone": "18601395213"
}
```

**リクエストパラメータ**

| 名前        | 位置    | タイプ       | 必須    | 説明             | 備考                                      |
| ----------- | ------- | ----------- | ------- | ---------------- | ----------------------------------------- |
| body        | body    | object      | no      |                  | なし                                      |
| » euserId   | body    | integer     | yes     | 外部ユーザーID    | なし                                      |
| » euserName | body    | string      | yes     | 外部ユーザー名    | なし                                      |
| » email     | body    | string¦null | yes     | ユーザーのメールアドレス | 少なくとも1つのメールアドレスと電話番号が存在する必要があります |
| » appName   | body    | string      | yes     | ソースチャンネル名 | なし                                      |
| » phone     | body    | string¦null | yes     | 携帯電話番号      | 少なくとも1つのメールアドレスと電話番号が存在する必要があります |

**レスポンス例**

成功時

```json
{
  "code": 0,
  "msg": "",
  "data": {}
}
```

失敗時

```json
{
  "code": 500008,
  "msg": "ユーザーのWeb3アドレス生成に失敗しました",
  "data": {}
}
```

**レスポンス結果**

| 条件コード | ステータスコードの意味                                | 指示        | データモデル  |
| -------------- | ------------------------------------------------------- | ----------- | ---------- |
| 200            | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功         | インライン   |

**データ構造の返却**

ステータスコード **200**

| name   | type    | required | restrain | explain | remark                      |
| ------ | ------- | -------- | -------- | ------- | --------------------------- |
| » code | integer | true     | none     |         | 返却コード                 |
| » msg  | string  | true     | none     |         | メッセージ情報            |
| » data | object  | true     | none     |         | 具体的な返却情報 information |

---


#### POST update

```
POST /user/update
```

> Web3サーバーでユーザー情報を更新し、異なるプラットフォームの異なる携帯電話番号や異なるメールアドレスは異なるユーザーとして扱われます。

**必須リクエストパラメータ** 

```json
{
  "phone": "18141248869",
  "appName": "damai",
  "euserId": 71
}
```

**必須パラメータ** 

| 名前        | 位置     | タイプ       | 必須    | 説明 | 備考 |
| ----------- | -------- | ----------- | ------- | ------- | ------ |
| body        | body     | object      | no      |         | なし   |
| » euserName | body     | string¦null | yes     |         | なし   |
| » phone     | body     | string¦null | yes     |         | なし   |
| » email     | body     | string¦null | yes     |         | なし   |
| » appName   | body     | string      | yes     |         | なし   |
| » euserId   | body     | integer     | yes     |         | なし   |


**レスポンス例**

成功時

```json
{
  "code": 0,
  "msg": "",
  "data": {}
}
```

失敗時

```json
{
  "code": 500006,
  "msg": "ユーザーが存在しません",
  "data": {}
}
```

**レスポンス結果**

| 条件コード | ステータスコードの意味                                | 説明     | データモデル  |
| -------------- | ------------------------------------------------------- | ----------- | ---------- |
| 200            | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功        | インライン   |


**返却データ構造**

条件コード **200**

| name   | type    | required | restrain | 説明     | 備考          |
| ------ | ------- | -------- | -------- | ------- | ------------ |
| » code | integer | true     | none     |         | メッセージコード |
| » msg  | string  | true     | none     |         | 情報          |
| » data | object  | true     | none     |         | データ          |

---

#### POST delete

```
POST /user/delete
```

> メールおよびチャンネルによると、ユーザーを削除します。ソフト削除として処理します。

**必須パラメータ**

```json
{
  "appName": "damai",
  "euserId": 79
}
```

**必須パラメータ**

| 名前      | 位置     | タイプ   | 必須      | 説明             | 備考   |
| --------- | -------- | ------- | -------- | ----------------- | ------ |
| body      | body     | object  | no       |                   | なし   |
| » appName | body     | string  | yes      | アプリ名          | なし   |
| » euserId | body     | integer | yes      | 外部ユーザーID    | なし   |

**返り値の例**

成功

```json
{
  "code": 0,
  "msg": "",
  "data": {}
}
```

ユーザーが存在しない場合

```json
{
  "code": 500006,
  "msg": "ユーザーが存在しません",
  "data": {}
}
```

**返り値**

| 条件コード | ステータスコードの意味                                   | 説明   | データモデル |
| -------------- | ------------------------------------------------------- | ------- | ------------ |
| 200            | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功   | インライン   |

**データ構造**

条件コード **200**

| 名前   | タイプ    | 必須     | 制限      | 説明   | 備考   |
| ------ | ------- | -------- | -------- | ------- | ------ |
| » code | integer | true     | なし     |         | なし   |
| » msg  | string  | true     | なし     |         | なし   |
| » data | object  | true     | なし     |         | なし   |

---

#### POST purchasenft

```
POST /order/purchasenft
```

> アプリはNFT購入リクエストをWeb3サーバーにプッシュし、Web3サーバーは注文をペンディング状態に初期化します。この注文はWeb3サーバーのバックエンドロジックとNFTによって発行されます。

**必須パラメータ**

```json
{
  "appName": "damai",
  "nftActivityName": "jackchou ticket",
  "price": 0,
  "amount": 15,
  "euserId": 70,
  "enftId": 12
}
```

**必須パラメータ**

| 名前                | 位置     | タイプ   | 必須      | 説明                               | 備考   |
| ------------------- | -------- | ------- | -------- | --------------------------------- | ------ |
| body                | body     | object  | no       |                                   | なし   |
| » appName           | body     | integer | yes      | アプリ名                           | なし   |
| » nft Activity Name | body     | string  | yes      | 購入したNFTのプロジェクト名         | なし   |
| » price             | body     | integer | yes      | 価格                              | なし   |
| » amount            | body     | integer | yes      | 購入数量                           | なし   |
| » euserId           | body     | integer | yes      | 外部ユーザーID                     | なし   |
| » enftId            | body     | integer | yes      | 外部NFTアクティブID                | なし   |

**返り値の例**

成功

```json
{
  "code": 0,
  "msg": "",
  "data": ""
}

{
  "code": 600002,
  "msg": "ユーザーがNFTを購入する際、数量が要件を満たしていません",
  "data": "in consequat"
}
```

**返り値**

| 条件コード | ステータスコードの意味                                   | 説明   | データモデル |
| -------------- | ------------------------------------------------------- | ------- | ------------ |
| 200            | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功   | インライン   |

**データ構造**

条件コード **200**

| 名前   | タイプ    | 必須     | 制限      | 説明   | 備考   |
| ------ | ------- | -------- | -------- | ------- | ------ |
| » code | integer | true     | なし     |         | なし   |
| » msg  | string  | true     | なし     |         | なし   |
| » data | string  | true     | なし     |         | なし   |

---


#### POST login

```
POST /user/login
```

> Web3ログインインターフェース。アドレスがあれば直接返信し、Web3アドレスがなければ生成してバインドします。

**必須パラメータ**

```json
{
  "appName": "damai",
  "euserId": 54
}
```

**必須パラメータ**

| 名前      | 位置     | タイプ   | 必須      | 説明             | 備考   |
| --------- | -------- | ------- | -------- | ----------------- | ------ |
| body      | body     | object  | no       |                   | なし   |
| » appName | body     | string  | yes      | チャンネル名       | なし   |
| » euserId | body     | integer | yes      | 外部ユーザーID     | なし   |

**返り値の例**

成功

```json
{
  "code": 0,
  "msg": "",
  "data": {}
}

{
  "code": 500008,
  "msg": "ユーザー生成のWeb3アドレスに失敗しました",
  "data": {}
}
```

**返り値**

| 条件コード | ステータスコードの意味                                   | 説明   | データモデル |
| -------------- | ------------------------------------------------------- | ------- | ------------ |
| 200            | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功   | インライン   |

**データ構造**

条件コード **200**

| 名前   | タイプ    | 必須     | 制限      | 説明   | 備考   |
| ------ | ------- | -------- | -------- | ------- | ------ |
| » code | integer | true     | なし     |         | なし   |
| » msg  | string  | true     | なし     |         | なし   |
| » data | object  | true     | なし     |         | なし   |

---


#### POST addactivity

```
POST /nft/addactivity
```

> アプリにNFTアクティビティを追加する機能を提供します。

**必須パラメータ**

```json
{
  "nftActivityName": "jackchou In Concert",
  "imageFileName": "picture.jpg",
  "appName": "damai",
  "enftId": 29,
  "imageFileContent": "画像のBase64エンコーディング"
}
```

**必須パラメータ**

| 名前                  | 位置     | タイプ   | 必須      | 説明                        | 備考   |
| --------------------- | -------- | ------- | -------- | -------------------------- | ------ |
| body                  | body     | object  | no       |                            | なし   |
| » nft Activity Name   | body     | string  | yes      | アクティビティ名            | なし   |
| » image File Name     | body     | string  | yes      | 画像ファイル名             | なし   |
| » app Name            | body     | string  | yes      | チャンネル名               | なし   |
| » enft Id             | body     | integer | yes      | 外部NFTアクティブID         | なし   |
| » image File Content  | body     | string  | yes      | 画像のBase64エンコーディング | なし   |

**返り値の例**

成功

```json
{
  "code": 0,
  "msg": "",
  "data": {}
}

{
  "code": 500008,
  "msg": "同一チャンネルの同じIDのNFTアクティビティがすでに存在します",
  "data": {}
}
```

**返り値**

| 条件コード | ステータスコードの意味                                   | 説明   | データモデル |
| -------------- | ------------------------------------------------------- | ------- | ------------ |
| 200            | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功   | インライン   |

**データ構造**

条件コード **200**

| 名前   | タイプ    | 必須     | 制限      | 説明   | 備考   |
| ------ | ------- | -------- | -------- | ------- | ------ |
| » code | integer | true     | なし     |         | なし   |
| » msg  | string  | true     | なし     |         | なし   |
| » data | object  | true     | なし     |         | なし   |

---

#### POST addactivity

```
POST /nft/addactivity
```

> アプリにNFTアクティビティを追加する機能を提供します。

**必須パラメータ**

```json
{
  "nftActivityName": "jackchou In Concert",
  "imageFileName": "picture.jpg",
  "appName": "damai",
  "enftId": 29,
  "imageFileContent": "画像のBase64エンコーディング"
}
```

**必須パラメータ**

| 名前                  | 位置     | タイプ   | 必須      | 説明                        | 備考   |
| --------------------- | -------- | ------- | -------- | -------------------------- | ------ |
| body                  | body     | object  | no       |                            | なし   |
| » nft Activity Name   | body     | string  | yes      | アクティビティ名            | なし   |
| » image File Name     | body     | string  | yes      | 画像ファイル名             | なし   |
| » app Name            | body     | string  | yes      | チャンネル名               | なし   |
| » enft Id             | body     | integer | yes      | 外部NFTアクティブID         | なし   |
| » image File Content  | body     | string  | yes      | 画像のBase64エンコーディング | なし   |

**返り値の例**

成功

```json
{
  "code": 0,
  "msg": "",
  "data": {}
}

{
  "code": 500008,
  "msg": "同一チャンネルの同じIDのNFTアクティビティがすでに存在します",
  "data": {}
}
```

**返り値**

| 条件コード | ステータスコードの意味                                   | 説明   | データモデル |
| -------------- | ------------------------------------------------------- | ------- | ------------ |
| 200            | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功   | インライン   |

**データ構造**

条件コード **200**

| 名前   | タイプ    | 必須     | 制限      | 説明   | 備考   |
| ------ | ------- | -------- | -------- | ------- | ------ |
| » code | integer | true     | なし     |         | なし   |
| » msg  | string  | true     | なし     |         | なし   |
| » data | object  | true     | なし     |         | なし   |

---


#### POST delete activity

```
POST /nft/deteteactivity
```

> NFTアクティビティを削除します。

**必須パラメータ**

```json
{
  "enftId": 80,
  "appName": "damai"
}
```

**必須パラメータ**

| 名前      | 位置     | タイプ   | 必須      | 説明                 | 備考           |
| --------- | -------- | ------- | -------- | ------------------- | -------------- |
| body      | body     | object  | no       |                     | なし           |
| » enftId  | body     | integer | yes      | 外部NFTアクティブID  | なし           |
| » appName | body     | string  | yes      | チャンネル名         | チャンネル名   |

**返り値の例**

成功

```json
{
  "code": 0,
  "msg": "",
  "data": {}
}

{
  "code": 600001,
  "msg": "NFTアクティビティが存在しません",
  "data": {}
}
```

**返り値**

| 条件コード | ステータスコードの意味                                   | 説明   | データモデル |
| -------------- | ------------------------------------------------------- | ------- | ------------ |
| 200            | [OK](https://tools.ietf.org/html/rfc7231#section-6.3.1) | 成功   | インライン   |

**データ構造**

条件コード **200**

| 名前   | タイプ    | 必須     | 制限      | 説明   | 備考   |
| ------ | ------- | -------- | -------- | ------- | ------ |
| » code | integer | true     | なし     |         | なし   |
| » msg  | string  | true     | なし     |         | なし   |
| » data | object  | true     | なし     |         | なし   |

---


# パラメータ形式の説明

ユーザー名、アプリ名、アクティビティ名の規則:

- 長さは6から30文字である必要があります。ユーザー名は文字、数字、または記号の任意の組み合わせであることができます。

- アンド記号（&）、等号（=）、アンダーバー（_）、アポストロフィ（'）、ダッシュ（-）、プラス（+）、英語のコンマ（,）、シャープブラケット（<、>）、または複数の連続したドット（.）を含めないでください。

- ドット（.）を始めまたは終わりに配置することはできますが、非英数字の文字はそれ以外の場所に配置することができます。

電話番号: 日本の携帯電話番号のルール

euserId、enftID: 外部ユーザーID、外部NFTアクティブIDは0より大きい必要があります。







# エラーコードの説明

返されるメッセージの中で、エラーメッセージはcodeとmsgで示されます。このエラーコード表は定期的に更新され、情報タイプは以下の通りです：

| code   | msg                                                          |
| ------ | ------------------------------------------------------------ |
| 500001 | ユーザー名の形式が準拠していません                             |
| 500002 | ユーザー名の長さが要件を満たしていません                       |
| 500003 | 携帯電話番号の形式が要件を満たしていません                       |
| 500004 | 携帯電話番号の長さが要件を満たしていません                       |
| 500005 | メールボックスの形式が要件を満たしていません                       |
| 500006 | ユーザーが存在しません                                       |
| 500007 | ユーザーは既に存在します                                     |
| 500008 | ユーザー生成のWeb3アドレスに失敗しました                        |
| 600001 | NFTアクティビティが存在しません                               |
| 600002 | NFTの購入数量が要件を満たしていません                           |
| 600003 | ユーザーが注文を行うことに失敗しました                         |
| 600004 | 同じチャンネルの同じIDのNFTアクティビティが既に存在します         |
| 700001 | リクエストヘッダーの認証が空です                               |
| 700002 | リクエストヘッダーの認証形式エラーです                           |

# インターフェースセキュリティ設計

主流のRESTful API設計方法を採用しているため、状態を持たない設計です。認証が行われない場合、セキュリティに重大な影響を与える可能性があります。以下は、お好みで選択できる3つのオプションです。


## API認証スキーム

• Cookie+セッション方式：最も伝統的な認証方式であり、使用シナリオが限られる場合があります。

• APIキー+APIシークレット方式：一般的に、各APIにはKeyとSecretのペアが割り当てられる必要があります。多くのKeyとSecretが存在する場合、サーバーには一定の保存コストがかかります。

• トークンメカニズムに基づく：具体的な実装方法が多数あり、主流の技術としてはJWTが採用されています。

開発中にインターフェースのセキュリティを向上させるために他の関連技術手段も考慮されます：

• タイムスタンプを追加してタイムアウトリプレイ攻撃を防止する

• HTTPSを使用する：データの明示的な送信を防止する

• インターフェースのレート制限：DDoS攻撃を防止する

# 備考

開発状況に応じて、この文書は常に調整され、調整がある場合にはコミュニケーションが行われます。